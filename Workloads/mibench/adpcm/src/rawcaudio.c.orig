/* testc - Test adpcm coder */

#include "adpcm.h"
#include <stdio.h>
#include <roi.h>

struct adpcm_state state;

#define NSAMPLES 1000

/*char	abuf[NSAMPLES/2];*/
/*short	sbuf[NSAMPLES];*/


main() {
    int n;
    short * sbuf = (char* )malloc(NSAMPLES * sizeof(short));
    char * abuf = (char* )malloc(NSAMPLES/2 * sizeof(char));

    while(1) {
        n = read(0, sbuf, NSAMPLES*2);
        if ( n < 0 ) {
            perror("input file");
            exit(1);
        }
        if ( n == 0 ) break;
        __app_roi_begin();
        adpcm_coder(sbuf, abuf, n/2, &state);
        __app_roi_end();
        write(1, abuf, n/4);
    }
    fprintf(stderr, "Final valprev=%d, index=%d\n",
            state.valprev, state.index);
    exit(0);
}
